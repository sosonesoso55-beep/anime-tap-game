<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Anime Tap Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial}
body{
  margin:0;
  background:url("bg.jpg") center/cover no-repeat fixed;
  color:#fff;
}
#overlay{
  background:rgba(0,0,0,.55);
  min-height:100vh;
}
header{
  display:flex;
  justify-content:space-between;
  padding:16px;
  font-size:22px;
  background:rgba(0,0,0,.5);
}
#currency{
  font-size:40px;
  margin:20px 0;
}
#girl{
  width:340px;
  max-width:90%;
  transition:.1s;
}
#menu{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  justify-content:space-around;
  padding:14px;
  background:rgba(0,0,0,.7);
}
button{
  padding:14px 18px;
  font-size:18px;
  border-radius:14px;
  border:none;
  background:#ff7ad9;
  color:#000;
  font-weight:bold;
}
.window{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  display:none;
  flex-direction:column;
  align-items:center;
  padding-top:50px;
}
.window h2{font-size:34px}
.star{
  position:absolute;
  font-size:30px;
  animation:fly 1s forwards;
}
@keyframes fly{
  to{transform:translateY(-150px) scale(0);opacity:0}
}
</style>
</head>

<body>
<div id="overlay">

<header>
  <div>üíé <span id="crystals">0</span></div>
  <button onclick="openWin('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
</header>

<div id="currency">üíé 0</div>

<img id="girl" src="girl.png">

<div id="menu">
  <button onclick="openWin('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="openWin('leader')">–¢–æ–ø</button>
  <button onclick="toggleMusic()">üéµ</button>
</div>

</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profile" class="window">
  <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
  <div>ID: <span id="uid"></span></div>
  <div>–ö—Ä–∏—Å—Ç–∞–ª–ª—ã: <span id="pcoins"></span></div>
  <div>–¢–∞–ø—ã: <span id="ptaps"></span></div>
  <div>–ë—É—Å—Ç: <span id="pboost">–Ω–µ—Ç</span></div>
  <div>–û—Å—Ç–∞–ª–æ—Å—å: <span id="ptime">‚Äî</span></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div id="shop" class="window">
  <h2>üõí –ú–∞–≥–∞–∑–∏–Ω</h2>
  <button onclick="buyBoost(2,600)">x2 ‚Äî 10 –º–∏–Ω</button>
  <button onclick="buyBoost(5,2500)">x5 ‚Äî 10 –º–∏–Ω</button>
  <button onclick="autoTap()">–ê–≤—Ç–æ—Ç–∞–ø 5 –º–∏–Ω</button>
  <button onclick="bonus()">+500 üíé</button>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –õ–ò–î–ï–†–ë–û–†–î -->
<div id="leader" class="window">
  <h2>üèÜ –¢–æ–ø</h2>
  <div id="leaders"></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<audio id="music" loop>
  <source src="music.mp3">
</audio>

<script>
const SERVER="https://anime-tap-server-1.onrender.com";
const uid=localStorage.uid||(localStorage.uid=Math.random().toString(36).slice(2));
let coins=0,taps=0,mult=1,boostEnd=0;

uidSpan.innerText=uid;

async function tap(e){
  taps++;
  coins+=mult;
  update();
  effect(e);
}

function update(){
  crystals.innerText=coins;
  currency.innerText="üíé "+coins;
  pcoins.innerText=coins;
  ptaps.innerText=taps;
}

function effect(e){
  girl.style.transform="scale(.95)";
  setTimeout(()=>girl.style.transform="scale(1)",100);
  const s=document.createElement("div");
  s.className="star";
  s.innerText="üíé";
  s.style.left=e.clientX+"px";
  s.style.top=e.clientY+"px";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),1000);
}

function buyBoost(x,price){
  if(coins<price) return alert("–ú–∞–ª–æ üíé");
  coins-=price;
  mult=x;
  boostEnd=Date.now()+600000;
  pboost.innerText="x"+x;
  timer();
  closeAll();
}

function autoTap(){
  let end=Date.now()+300000;
  let i=setInterval(()=>{
    if(Date.now()>end){clearInterval(i);return;}
    coins+=mult;
    update();
  },500);
}

function bonus(){coins+=500;update();}

function timer(){
  let t=setInterval(()=>{
    let left=Math.max(0,boostEnd-Date.now());
    ptime.innerText=Math.ceil(left/1000)+"—Å";
    if(left<=0){mult=1;pboost.innerText="–Ω–µ—Ç";clearInterval(t);}
  },1000);
}

function openWin(id){
  closeAll();
  document.getElementById(id).style.display="flex";
}
function closeAll(){
  document.querySelectorAll(".window").forEach(w=>w.style.display="none");
}
function toggleMusic(){
  music.paused?music.play():music.pause();
}

girl.onclick=tap;
</script>
</body>
</html>
