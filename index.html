<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Anime Tap Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{
  box-sizing:border-box;
  font-family:Arial, sans-serif;
}
body{
  margin:0;
  background:linear-gradient(180deg,#0f1020,#05050b);
  color:#fff;
}
#app{
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}

/* –®–ê–ü–ö–ê */
header{
  width:100%;
  padding:20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#14162e;
  font-size:22px;
}

/* –°–ß–Å–¢ */
#score{
  font-size:42px;
  margin:20px 0;
  font-weight:bold;
}

/* –î–ï–í–û–ß–ö–ê */
#girl{
  width:320px;
  max-width:90%;
  transition:transform .1s;
  user-select:none;
}

/* –ö–ù–û–ü–ö–ò –ù–ò–ó */
#menu{
  position:fixed;
  bottom:0;
  width:100%;
  background:#14162e;
  display:flex;
  justify-content:space-around;
  padding:16px 0;
}
#menu button{
  font-size:18px;
  padding:12px 18px;
  border-radius:14px;
  border:none;
  background:#7b5cff;
  color:white;
  font-weight:bold;
}

/* –û–ö–ù–ê */
.window{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.92);
  display:none;
  flex-direction:column;
  align-items:center;
  padding-top:60px;
}
.window h2{
  font-size:32px;
  margin-bottom:20px;
}
.window button{
  margin:10px;
  padding:16px 22px;
  font-size:20px;
  border-radius:14px;
  border:none;
  background:#7b5cff;
  color:white;
}

/* –ó–í–Å–ó–î–´ */
.star{
  position:absolute;
  font-size:28px;
  animation:fly 1s forwards;
  pointer-events:none;
}
@keyframes fly{
  to{
    transform:translateY(-150px) scale(0);
    opacity:0;
  }
}
</style>
</head>

<body>
<div id="app">

<header>
  <div>‚≠ê <span id="stars">0</span></div>
  <button onclick="openWin('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
</header>

<div id="score">0</div>

<img id="girl" src="girl.png">

<div id="menu">
  <button onclick="openWin('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="openWin('leader')">–¢–æ–ø</button>
  <button onclick="toggleMusic()">üéµ</button>
</div>

</div>

<!-- –ú–ê–ì–ê–ó–ò–ù -->
<div id="shop" class="window">
  <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
  <button onclick="buy(2,500)">x2 –Ω–∞ 10 –º–∏–Ω (500)</button>
  <button onclick="buy(5,3000)">x5 –Ω–∞ 10 –º–∏–Ω (3000)</button>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –õ–ò–î–ï–†–ë–û–†–î -->
<div id="leader" class="window">
  <h2>–õ–∏–¥–µ—Ä–±–æ—Ä–¥</h2>
  <div id="leaders" style="font-size:22px"></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<!-- –ü–†–û–§–ò–õ–¨ -->
<div id="profile" class="window">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <div style="font-size:22px">ID: <span id="uid"></span></div>
  <div style="font-size:22px">–û—á–∫–∏: <span id="pscore"></span></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<audio id="music" loop>
  <source src="music.mp3">
</audio>

<script>
const SERVER="https://anime-tap-server-1.onrender.com";
const uid=localStorage.uid||(localStorage.uid=Math.random().toString(36).slice(2));
let score=0;
let mult=1;
let musicOn=false;

uidSpan=document.getElementById("uid");
uidSpan.innerText=uid;

async function tap(e){
  const r=await fetch(SERVER+"/tap",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({id:uid})
  });
  const d=await r.json();
  score=d.score;
  render();
  effect(e);
}

function render(){
  document.getElementById("score").innerText=score;
  document.getElementById("pscore").innerText=score;
}

function effect(e){
  girl.style.transform="scale(.95)";
  setTimeout(()=>girl.style.transform="scale(1)",100);

  const s=document.createElement("div");
  s.className="star";
  s.innerText="‚≠ê";
  s.style.left=e.clientX+"px";
  s.style.top=e.clientY+"px";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),1000);
}

function openWin(id){
  closeAll();
  document.getElementById(id).style.display="flex";
  if(id==="leader") loadLeaders();
}
function closeAll(){
  document.querySelectorAll(".window").forEach(w=>w.style.display="none");
}

async function loadLeaders(){
  const r=await fetch(SERVER+"/leaderboard");
  const d=await r.json();
  document.getElementById("leaders").innerHTML=
    d.map((x,i)=>`${i+1}. ${x.id.slice(0,5)}‚Ä¶ ‚Äî ${x.score}`).join("<br>");
}

function buy(x,price){
  if(score<price) return alert("–ú–∞–ª–æ –æ—á–∫–æ–≤");
  mult=x;
  setTimeout(()=>mult=1,600000);
  closeAll();
}

function toggleMusic(){
  musicOn=!musicOn;
  musicOn?music.play():music.pause();
}

girl=document.getElementById("girl");
girl.onclick=tap;
</script>
</body>
</html>
