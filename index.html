<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Anime Tap Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html,body{
  margin:0;
  padding:0;
  background:#0b0b12;
  color:white;
  font-family:Arial;
  overflow:hidden;
}
#app{
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
}
header{
  width:100%;
  padding:10px;
  display:flex;
  justify-content:space-between;
  background:#141428;
}
button{
  background:#7b5cff;
  border:none;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  font-weight:bold;
}
#score{
  font-size:26px;
  margin:10px;
}
#girl{
  width:260px;
  user-select:none;
  transition:transform .08s;
}
#panel{
  position:fixed;
  bottom:0;
  width:100%;
  display:flex;
  justify-content:space-around;
  background:#141428;
  padding:10px;
}
.window{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.window button{margin:6px;}
.star{
  position:absolute;
  color:gold;
  pointer-events:none;
  animation:fly 1s forwards;
}
@keyframes fly{
  to{transform:translateY(-120px) scale(0);opacity:0;}
}
</style>
</head>

<body>
<div id="app">

<header>
  <div>‚≠ê <span id="stars">0</span></div>
  <button onclick="openWin('profile')">–ü—Ä–æ—Ñ–∏–ª—å</button>
</header>

<div id="score">0</div>
<img id="girl" src="girl.png">

<div id="panel">
  <button onclick="openWin('shop')">–ú–∞–≥–∞–∑–∏–Ω</button>
  <button onclick="openWin('leader')">–õ–∏–¥–µ—Ä–±–æ—Ä–¥</button>
  <button onclick="toggleMusic()">üéµ</button>
</div>

</div>

<!-- –û–ö–ù–ê -->
<div id="shop" class="window">
  <h2>–ú–∞–≥–∞–∑–∏–Ω</h2>
  <button onclick="buy(2,500)">x2 (10 –º–∏–Ω)</button>
  <button onclick="buy(5,3000)">x5 (10 –º–∏–Ω)</button>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="leader" class="window">
  <h2>–¢–æ–ø</h2>
  <div id="leaders"></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<div id="profile" class="window">
  <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
  <div>ID: <span id="uid"></span></div>
  <div>–û—á–∫–∏: <span id="pscore"></span></div>
  <button onclick="closeAll()">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<audio id="music" loop>
  <source src="music.mp3">
</audio>

<script>
const SERVER = "https://anime-tap-server-1.onrender.com";
const uid = localStorage.uid || (localStorage.uid = Math.random().toString(36).slice(2));
let score = 0;
let mult = 1;
let musicOn = false;

document.getElementById("uid").innerText = uid;

async function tap(e){
  const r = await fetch(SERVER+"/tap",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({id:uid})
  });
  const d = await r.json();
  score = d.score;
  render();
  fx(e);
}

function render(){
  scoreEl.innerText = score;
  pscore.innerText = score;
}

function fx(e){
  girl.style.transform="scale(.94)";
  setTimeout(()=>girl.style.transform="scale(1)",80);
  const s=document.createElement("div");
  s.className="star";
  s.innerText="‚≠ê";
  s.style.left=e.clientX+"px";
  s.style.top=e.clientY+"px";
  document.body.appendChild(s);
  setTimeout(()=>s.remove(),1000);
}

async function loadLeaders(){
  const r=await fetch(SERVER+"/leaderboard");
  const d=await r.json();
  leaders.innerHTML=d.map(x=>`${x.id.slice(0,5)}... ‚Äî ${x.score}`).join("<br>");
}

function buy(x,price){
  if(score<price) return alert("–ú–∞–ª–æ –æ—á–∫–æ–≤");
  mult=x;
  setTimeout(()=>mult=1,600000);
  closeAll();
}

function openWin(id){
  closeAll();
  document.getElementById(id).style.display="flex";
  if(id==="leader") loadLeaders();
}
function closeAll(){
  document.querySelectorAll(".window").forEach(w=>w.style.display="none");
}

function toggleMusic(){
  musicOn=!musicOn;
  musicOn?music.play():music.pause();
}

girl.onclick=tap;
scoreEl=document.getElementById("score");
</script>
</body>
</html>
